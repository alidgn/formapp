
@{
    ViewBag.Title = "Formlar";
}

<h2>Formlar</h2>
<hr />
<br />
<button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#newForm">Form Oluştur</button>
<input type="text" id="search" placeholder="Ara" />
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Form Adı</th>
            <th>Form Açıklaması</th>
            <th>Form Sahibi</th>
            <th>Tarih</th>
        </tr>
    </thead>
    <tbody id="content"></tbody>
</table>

<div id="formModal" class="modal fade" role="dialog" aria-labelledby="formModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3 id="formTitle"></h3>
            </div>
            <div class="modal-body">
                <p id="formDesc"></p>
            </div>
            <div class="modal-body">
                <div class="form-horizontal">
                    <div class="form-group">
                        <label class="control-label col-md-2">Ad</label>
                        <div class="col-md-10">
                            <input class="form-control" name="name" id="fieldName" type="text" placeholder="Ad giriniz." required />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">Soyad</label>
                        <div class="col-md-10">
                            <input class="form-control" name="surname" id="fieldSurname" type="text" placeholder="Soyad giriniz." required />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">Yaş</label>
                        <div class="col-md-10">
                            <input class="form-control" name="age" id="fieldAge" type="number" placeholder="Yaş giriniz." />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <p id="formDate"></p>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div id="newForm" class="modal fade" role="dialog" aria-labelledby="newFormLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3>Yeni Form Oluştur</h3>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary">Oluştur</button>
            </div>
        </div>
    </div>
</div>


<script>

    function getForms() {
        $.ajax({
            dataType: "json",
            url: "/i/forms",
            success: function doldur(d) {
                console.log(d);
                if (d === "unauthorized") {
                    window.location.href = "/account/login";
                } else if (d === "notfound") {
                    window.location.href = "/i/pano";
                } else {
                    d.forEach(i => {
                        $('#content').append('<tr data-toggle="modal" data-id="' + i.Id + '"onclick="getFormById(' + i.Id + ')" data-target="#formModal">' +
                            '<td>' + i.Name + '</td>' +
                            '<td>' + i.Description + '</td>' +
                            '<td>' + i.Users.Username + '</td>' +
                            '<td>' + i.CreatedAt + '</td>' +
                            '</tr>');
                    });
                }
            }
        });
    }

    $("#search").on("keyup", function () {
        var value = $(this).val();
        $("table tr").each(function (index) {
            if (index !== 0) {
                $row = $(this);
                console.log($row)
                var id = $row.find("td:first").text().trim().toLocaleLowerCase();
                console.log(id)
                if (id.indexOf(value) !== 0) {
                    $row.hide();
                }
                else {
                    $row.show();
                }
            }
        });
    });

    function getFormById(id) {
        console.log(id);
        $.ajax({
            dataType: "json",
            url: "/i/forms/" + id,
            success: function doldur(d) {
                console.log(d);
                $('#formTitle').text(d.Name);
                $('#formDesc').text(d.Description);
                $('#formDate').text(d.CreatedAt);
                $('#fieldName').val(d.Fields.Name);
                $('#fieldSurname').val(d.Fields.Surname);
                $('#fieldAge').val(d.Fields.Age);
            }
        });
    }

    function postNewForm() {
        $.ajax({
            type:"post",
            dataType: "json",
            url: "/i/forms",
            data: { },
            success: function doldur(d) {
                console.log(d);        
            }
        });
    }

    $(document).ready(function () {
        getForms();        
    });

</script>

@*<button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#newForm">Form Oluştur</button>
<input type="text" id="search" placeholder="Ara" />
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Form Adı</th>
            <th>Form Açıklaması</th>
            <th>Form Sahibi</th>
            <th>Tarih</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr data-toggle="modal" data-id="@item.Id" data-target="#formModal">
                <td>@item.Name</td>
                <td>@item.Description</td>
                <td>@item.Users.Username</td>
                <td>@item.CreatedAt.ToString("yyyy-MM-dd")</td>
            </tr>
        }
    </tbody>
</table>

<div id="formModal" class="modal fade" role="dialog" aria-labelledby="formModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3 id="formTitle"></h3>
            </div>
            <div class="modal-body">
                <p id="formDesc"></p>
            </div>
            <div class="modal-body">
                <div class="form-horizontal">
                    <div class="form-group">
                        <label class="control-label col-md-2">Ad</label>
                        <div class="col-md-10">
                            <input class="form-control" name="name" id="fieldName" type="text" placeholder="Ad giriniz." required />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">Soyad</label>
                        <div class="col-md-10">
                            <input class="form-control" name="surname" id="fieldSurname" type="text" placeholder="Soyad giriniz." required />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-2">Yaş</label>
                        <div class="col-md-10">
                            <input class="form-control" name="age" id="fieldAge" type="number" placeholder="Yaş giriniz." />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <p id="formDate"></p>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div id="newForm" class="modal fade" role="dialog" aria-labelledby="newFormLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3>Yeni Form Oluştur</h3>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary">Oluştur</button>
            </div>
        </div>
    </div>
</div>

<script>
    $("#search").on("keyup", function () {
        var value = $(this).val();
        $("table tr").each(function (index) {
            if (index !== 0) {
                $row = $(this);
                console.log($row)
                var id = $row.find("td:first").text().trim().toLocaleLowerCase();
                console.log(id)
                if (id.indexOf(value) !== 0) {
                    $row.hide();
                }
                else {
                    $row.show();
                }
            }
            else {
                $row = $(this);
                $row.html("Kayıt bulunamadı")
            }
        });
    });

    $(function () {
        $('td').on('click', function () {
            var formId = $(event.target).closest('tr').data('id');
            //make your ajax call populate items or what even you need
            console.log("çalıştı", formId)
            $.ajax({
                dataType: "json",
                url: "/i/forms/" + formId,
                success: function doldur(d) {
                    console.log(d);
                    $('#formTitle').text(d.Name);
                    $('#formDesc').text(d.Description);
                    $('#formDate').text(d.CreatedAt);
                    $('#fieldName').val(d.Fields.Name);
                    $('#fieldSurname').val(d.Fields.Surname);
                    $('#fieldAge').val(d.Fields.Age);
                }
            });
        });
    });

</script>*@



